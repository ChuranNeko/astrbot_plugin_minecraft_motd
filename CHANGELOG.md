# 更新日志 / Changelog

所有重要的变更都将记录在此文件中。

## [2.0.0] - 2025-10-30

### 🎉 重大更新

这是一个重大版本更新，完全重写了渲染系统，从传统的 PIL 图像绘制升级到现代化的 HTML 渲染技术。

### ✨ 新增特性

- **HTML 渲染引擎**：集成 AstrBot V4 的 HTML 渲染功能，使用浏览器引擎生成高质量图片
- **现代化界面设计**：
  - 采用渐变配色方案（深色主题）
  - 圆角卡片设计，增强视觉美感
  - 添加阴影和边框效果
  - 响应式网格布局
- **动画效果**：在线状态指示器支持呼吸灯动画
- **更好的图标支持**：服务器 favicon 直接通过 HTML 渲染，失败时显示默认 emoji 图标（⛏️）
- **优化的信息展示**：使用 Flexbox 和 Grid 布局，信息展示更加清晰有序

### 🔄 变更内容

- **渲染方式**：从 PIL (Pillow) 图像绘制改为 HTML + Jinja2 模板渲染
- **模板系统**：新增 `templates/server_status.html` Jinja2 模板文件
- **字体加载**：字体通过 CSS @font-face 加载，不再需要 Python PIL 字体处理

### 🗑️ 移除内容

- 移除了以下不再需要的依赖：
  - `Pillow` (PIL 图像处理库)
  - `requests` (HTTP 请求库)
- 移除了以下方法：
  - `_load_font()` - PIL 字体加载
  - `_load_server_icon()` - PIL 图标加载
  - `_render_content()` - PIL 内容绘制
  - `_wrap_text()` - PIL 文本折行
  - `_save_temp_image()` - 临时图片保存
  - `_cleanup_file()` - 临时文件清理
- 移除了以下导入：
  - `base64`
  - `BytesIO`
  - `tempfile`
  - `PIL` 相关模块

### ⚡ 性能优化

- **更高的图片质量**：浏览器渲染引擎提供更清晰的文字和图标
- **更少的依赖**：减少了 2 个第三方依赖包
- **更简洁的代码**：渲染逻辑大幅简化，维护成本降低
- **更快的渲染速度**：AstrBot 的 HTML 渲染引擎经过优化，性能更佳

### 🐛 Bug 修复

- 修复了 PIL 渲染时字体加载失败的问题
- 修复了临时文件清理可能失败的问题
- 改进了图标加载的稳定性

### 📝 文档更新

- 更新 `README.md`，添加 HTML 渲染相关说明
- 更新版本号到 2.0.0
- 更新依赖列表说明

### ⚠️ 破坏性变更

- **最低 AstrBot 版本要求**：需要 AstrBot V4，因为使用了 V4 的 HTML 渲染 API
- **Python 版本要求**：建议 Python 3.8+

### 🔧 迁移指南

如果您从 v1.x 升级到 v2.0：

1. 确保您使用的是 AstrBot V4
2. 卸载旧版本插件
3. 安装新版本插件
4. 插件会自动安装新的依赖（自动移除不需要的 Pillow 和 requests）

---

## [1.7.0] - 之前版本

### 特性

- 基于 PIL 的本地图片渲染
- 支持 Java 版和基岩版探测
- SRV 记录解析
- 异步并发探测
- 自动/手动探测模式切换
- IPv4/IPv6 支持
- Minecraft 字体支持

